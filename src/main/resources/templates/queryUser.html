<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户信息</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/jquery-3.2.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plug-in.min.js"></script>
    <style>
        html, body {
            background: #14191C;
            margin: 0;
        }
        .glyphicon-user {
            position: absolute;
            top:45px;
            left: 20px; }

        .glyphicon-lock {
            position: absolute;
            top: 117px;
            left: 20px; }
        .all{
            position: absolute;
            z-index: 999;
        }
        .tableUser {
            margin-top: 60px;
            font-size: 18px;
            color: #d1f5de;
        }

        .list-group-item-heading {
            list-style: none;
            color: whitesmoke;
            margin-left: 40px;
            margin-top: 20px;
        }
        .canvas{
            position: absolute;
            z-index: 666;
            right: -20px;
        }
        .navbar-inverse input[type="text"] {
            background: #313131;
            border: none;
            color: #999; }

        .navbar-inverse .navbar-form {
            position: relative; }

        .navbar-form button[type="submit"] {
            background: #313131;
            border: none;
            color: #999;
            position: absolute;
            top: 28%;
            right: 8%; }

        @media (min-width: 768px) {
            .navbar-form button[type="submit"] {
                top: 15%; } }
        .item img {
            width: 100%; }
        .dropdown-menu{
            margin: 0;
            padding: 0;
            border: 1px solid #000;
            background: #2f2f2f;
            min-width: 100px;
            height: 55px;
        }
        .dropdown-menu>li{
            width: 100px;
            border-radius: 4px;
        }
        .dropdown-menu>li a{
            color: #9a9a98;
            width: 100px;
            border-radius: 4px;
        }
        .dropdown-menu>li a:hover{
            background: #000000;
            color: white;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<!--导航-->
<nav class="navbar navbar-inverse navbar-fixed-top navtop">
    <div class="container">
        <div class="navbar-header">
            <button class="navbar-toggle" data-toggle="collapse"
                    data-target="#response-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="backHome" class="">
                <!--<strong>BY一考通</strong>-->
                <img src="images/LOGO_03.png" alt="LOGO" width="100px" style="display: block;line-height:90px;">
            </a>
        </div>
        <div class="collapse navbar-collapse" id="response-collapse">
            <ul class="nav navbar-nav ulDaoHang" id="nav">
                <li class="itemdisplay" style="display: none"><a href="toaddItem">添加试题</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="mockExam">模拟考试
                        <span class="caret">
                                </span>
                    </a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="mockExam">科目一</a></li>
                        <li><a href="mockExam4">科目四</a></li>
                    </ul>
                </li>
                <li><a href="practice">随机练习</a></li>
                <li><a href="practice2">顺序练习</a></li>
                <li><a href="#">联系我们</a></li>
            </ul>
            <div class="profile navbar-right">
                <ul class="nav navbar-nav">
                    <li class="nowuser" style="display: none;"><a href="#" id="loginOut">退出当前用户:</a></li>
                    <li><a href="displayUser" class="usernamedisplay"></a></li>
                    <li class="displaylogin"><a href="#" data-toggle="modal"
                                                data-target="#login-modal">登录</a></li>
                    <li class="displaylogin"><a href="#" data-toggle="modal"
                                                data-target="#register-modal">注册</a></li>
                </ul>
            </div>
        </div>
    </div>
</nav>
<!--试题-->
<div class="all">
    <div class="container">
        <div class="tableUser col-md-8 col-sm-12 col-xs-12">
            <span id="userJige" style="font-family: '微软雅黑';font-size: 16px;">考试合格率：</span><br>
            <table class="table table-bordered">
                <th class=" text-center username">试卷id</th>
                <th class=" text-center examItem" id="grade">分数</th>
                <th class=" text-center examItem" id="hege">考试合格</th>
                <th class=" text-center examItem" id="">考试类型</th>
                <th class=" text-center examItem" id="examTime">考试时间</th>
                <tbody class="listUser"></tbody>
            </table>
            <button class="btn btn-success" id="above">上一页</button>
            <button class="btn btn-success" id="next">下一页</button>
        </div>

    </div>
    <canvas class="canvas" id="canvas" style="display:block; margin:50px auto;">当前浏览器不支持canvascanvas</canvas>
</div>

<!--登录-->
<div class="modal fade login-modal" id="login-modal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close" data-dismiss="modal">&times;</button>
                <h4>
                    <b>用户登录</b>
                </h4>
            </div>
            <div class="modal-body">
                <div>
                    <!--<form method="post">-->
                    <div class="form-group">
                        <label for="username">Username <span
                                class="glyphicon glyphicon-user"></span> <input type="text"
                                                                                   name="username" class="form-control"
                                                                                   id="username"
                                                                                   placeholder="输入用户名"
                                                                                   style="padding-left: 22px"></label>
                    </div>
                    <div class="form-group">
                        <label for="password">Password <span
                                class="glyphicon glyphicon-lock"></span> <input type="password"
                                                                                   name="password" class="form-control"
                                                                                   id="password"
                                                                                   placeholder="输入密码"
                                                                                   style="padding-left: 22px"></label>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" class="btn btn-group-xs" id="userLogin" style="color: white;background: #000;" value="登录">
                        <!--<button onclick="loginUser()" class="btn btn-group-xs">login</button>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--注册-->
<div class="modal fade login-modal" id="register-modal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close" data-dismiss="modal">&times;</button>
                <h4>
                    <b>用户注册</b>
                </h4>
            </div>
            <div class="modal-body">
                <div id="form2">
                    <div class="form-group">
                        <label for="username">Username <span
                                class="glyphicon glyphicon-user"></span> <input type="text"
                                                              name="username" class="form-control"
                                                              id="rusername"
                                                              placeholder="输入用户名"
                                                              style="padding-left: 22px"></label>
                    </div>
                    <div class="form-group">
                        <label for="password">Password<span
                                class="glyphicon glyphicon-lock"></span>
                            <input type="password"
                                   name="password" class="form-control"
                                   id="rpassword"
                                   placeholder="输入密码"
                                   style="padding-left: 22px"></label>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-group-xs" style="color: white;background: #000;" id="userRegister">注册
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="js/beijing.js"></script>
<script>
    $(function () {
        var storage=window.localStorage;
        var username=storage.getItem("username");
        var pageNo=0;
        var pageSize=5;
        //下一页
        $("#next").on("click",function () {
            queryUser();
        });


        //上一页
        $("#above").on("click",function () {
            if(pageNo>6){
                pageNo=pageNo-pageSize-pageSize;
                queryUser();
            }else{
                $.Pop('没有上一页',{Animation:'layer-rollIn',Title:"<b>提示信息</b>"});
            }

        });

        queryUserAll();
        queryUser();



        //计算合格率
        function queryUserAll() {
            $.ajax({
                url : "queryUserAll",
                data : {
                    id:storage.getItem("id"),
                },
                type : "POST",
                dataType : "json",
                success : function(res) {
                    if(res.length==0){
                        $(".listUser").html("<div class='text-center list-group-item-heading'>" +"暂无数据......" + "</div>");
                    }else{
                        var jige=0;
                        var i=0;
                        for ( i;i<res.length;i++){
                            if(res[i].grade>=90){
                                jige=jige+1;
                            }
                        }
                        $("#userJige").html("考试合格率:"+(jige/i).toFixed(4)/10*1000+"%");
                    }
                }
            });
        }

        //获取用户信息
        function queryUser() {
            $.ajax({
                url : "queryUser",
                data : {
                    id:storage.getItem("id"),
                    pageNo:pageNo,
                    pageSize:pageSize

                },
                type : "POST",
                dataType : "json",
                success : function(res) {
                  if(res.length==0){
                      $(".listUser").html("<div class='text-center list-group-item-heading'>" +"暂无数据......" + "</div>");
                  }else{
                      var i=0;
                      var type="";
                    var html = "";
                    for ( i;i<res.length;i++){
                        //格式化日期
                        var hege="否";
                        if(res[i].grade>=90){
                            hege="是";
                        }
                        if(res[i].type==0){
                            type="科目一";
                        }
                        if(res[i].type==1){
                            type="科目四";
                        }
                         res[i].examTime = new Date(+new Date(res[i].examTime)+8*3600*1000).toISOString().replace(/T/g,' ').replace(/\.[\d]{3}Z/,'');
                        html += "<tr>";
                        html += "<td class='text-center'>" + res[i].id + "</td>";
                        html += "<td class='text-center'>" + res[i].grade + "</td>";
                        html += "<td class='text-center'>" + hege + "</td>";
                        html += "<td class='text-center'>" + type + "</td>";
                        html += "<td class='text-center'>" +res[i].examTime + "</td>";
                        html += "</tr>";
                    }
                    $(".listUser").html(html);
                  }
                    pageNo=pageNo+pageSize;
                }
            });
        }
        //显示\隐藏题库
        itemdisplay();
        function itemdisplay() {
            if(storage.getItem("type")!=1){
                $(".itemdisplay").css("display","none");
            }
        }
        //登陆成功后隐藏登录注册按钮
        function displayuser() {
            a = $(".usernamedisplay").text();
            if (a != "") {
                /* $(".displaylogin").css('display', 'none');
                 $(".nowuser").css('display', 'block');*/
                $(".wrongItem").fadeIn(1000);
                $(".displaylogin").fadeOut(1000);
                $(".nowuser").fadeIn(2000);
            }
        }

        //登录
        $("#userLogin").on("click", function () {
            $.ajax({
                url: "/login",//url
                type: "POST",//方法类型
                dataType: "json",//预期服务器返回的数据类型
                data: {username: $("#username").val(), password: $("#password").val()},
                success: function (res) {
                    storage.setItem("username", res.username);
                    storage.setItem("id", res.id);
                    storage.setItem("type", res.type);
                    $.Pop('<h5>登录成功</h5>','alert',function(){window.location.reload()});
                },
                error: function () {
                    $.Pop('<h5>登录失败，请重新登录</h5>','alert',function(){window.location.reload()});
                }
            });
        });

        //注册
        $("#userRegister").on("click", function () {
            $.ajax({
                url: "/register",
                type: "POST",
                dataType: "json",
                data: {username: $("#rusername").val(), password: $("#rpassword").val()},
                success: function (res) {
                    storage.setItem("username", res.username);
                    storage.setItem("id", res.id);
                    storage.setItem("type", res.type);
                    $.Pop('<h5>注册成功</h5>','alert',function(){window.location.reload()});
                }, error: function () {
                    $.Pop('<h5>注册失败，请重新注册</h5>','alert',function(){window.location.reload()});
                }

            });
        });
        //退出登录
        $("#loginOut").on("click", function () {
            localStorage.removeItem("username");
            localStorage.removeItem("id");
            localStorage.removeItem("type");
            window.location.reload(); //刷新当前页面
        });
        var storage = window.localStorage;
        //从localstorage获得用户信息
        $(".usernamedisplay").text(storage.getItem("username"));
        //刷新当前用户
        setInterval(function () {
            displayuser();
        }, 1000);
    })
</script>
</html>
</body>
</html>